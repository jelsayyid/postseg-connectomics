# Post-Segmentation Pipeline â€” Default Configuration
# All distances in nanometers unless otherwise noted.

pipeline:
  name: "post-segmentation-pipeline"
  version: "0.1.0"
  seed: 42  # For reproducibility

input:
  format: "hdf5"                # hdf5 | zarr | precomputed | numpy
  path: ""                      # Path to segmentation volume
  dataset: "labels"             # Dataset name within file (HDF5/Zarr)
  resolution: [30, 8, 8]        # Voxel size in nm (z, y, x)
  chunk_size: [128, 256, 256]   # Processing chunk size in voxels
  chunk_overlap: [8, 16, 16]    # Overlap for boundary stitching

fragments:
  min_voxel_count: 100          # Discard fragments smaller than this
  extract_skeletons: true
  extract_meshes: false
  skeleton_method: "teasar"     # teasar | topological
  skeleton_params:
    invalidation_d0: 10
    dust_threshold: 100

graph:
  construction_method: "proximity"  # contact | proximity | endpoint
  max_distance_nm: 2000             # Max distance to connect fragments

candidates:
  max_endpoint_distance_nm: 1500
  min_alignment_score: 0.3
  min_composite_score: 0.2
  weights:
    proximity: 0.35
    alignment: 0.30
    continuity: 0.25
    size: 0.10

validation:
  accept_threshold: 0.8
  reject_threshold: 0.3
  rules:
    - name: "MaxDistanceRule"
      params:
        max_distance_nm: 1500
    - name: "CurvatureRule"
      params:
        max_curvature_deg: 90
    - name: "DirectionReversalRule"
      params:
        min_alignment: 0.0
    - name: "SizeDiscrepancyRule"
      params:
        max_radius_ratio: 3.0
    - name: "BranchingLimitRule"
      params:
        max_branches: 10

assembly:
  min_structure_fragments: 2
  flag_ambiguous: true
  detect_cycles: true
  max_branch_order: 10

export:
  formats: ["graphml", "csv"]
  output_dir: "./output"
  include_rejected: false
  include_ambiguous: true

logging:
  level: "INFO"
  file: "pipeline.log"
  console: true
